<!DOCTYPE html>
<!--
Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
Click nbfs://nbhost/SystemFileSystem/Templates/Other/html.html to edit this template
-->
<html xlmns:th="http://www.thymeleaf.org" xlmns:layout="http://www.ultrag.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">
    <head>
        <title>Transaction</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body>
        <div class="container-fluid" layout:fragment="contents">

            <!-- Page Heading -->
            <h1 class="h3 mb-2 text-gray-800">Transaction</h1>


            <!-- DataTales Example -->
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h3 class="card-title">Transaction Report</h3>
                </div>
                <div class="card-header py-3">
                    <button onclick="ExportToPDF()" class="btn btn-primary">Export to PDF</button>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-bordered" id="tblWh" width="100%" cellspacing="0"  data-order='[[ 0, "desc" ]]' data-page-length='10'>
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Type</th>
                                    <th>Goods Name</th>
                                    <th>From</th>
                                    <th>To</th>
                                    <th>Quantity</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="item: ${trans}">
                                    <td th:text="${item.id}">Id</td>

                            <div th:if="${item.type.equals('in')}">
                                <td><span class="badge badge-warning">Allocate</span></td>
                            </div>
                            <div th:if="${item.type.equals('out')}">
                                <td><span class="badge badge-success">Issue</span></td>
                            </div>
                            <div th:if="${item.type.equals('unqualified')}">
                                <td><span class="badge badge-danger">Unqualified</span></td>
                            </div>
                            <div th:if="${item.type.equals('Recycle')}">
                                <td><span class="badge badge-primary">Recycle</span></td>
                            </div>
                            <div th:if="${item.type.equals('Disposed')}">
                                <td><span class="badge badge-danger">Disposed</span></td>
                            </div>

                            <td th:text="${item.goods_name}">Goods Name</td>
                            <td th:text="${item.from_loc}">From Location</td>
                            <td th:text="${item.to_loc}">To Location</td>
                            <td th:text="${item.quantity}">Quantity</td>


                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <script th:src="@{/vendor/jquery/jquery.min.js}"></script>
            <script th:src="@{/vendor/datatables/jquery.dataTables.min.js}"></script>
            <script th:src="@{/vendor/datatables/dataTables.bootstrap4.min.js}"></script>
            <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
            <script type="text/javascript" src="https://unpkg.com/xlsx@0.15.1/dist/xlsx.full.min.js"></script>
            <script src="//cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.3/jspdf.min.js"></script>
            <script src="https://unpkg.com/jspdf-autotable@3.5.22/dist/jspdf.plugin.autotable.js"></script>
            <script>
                        const logo = new Image();
                        logo.src = "http://localhost:8080/goods-photos/logo456.png";
                        logo.width = 200;
                        logo.height = 130;
                        function ExportToPDF() {
                            const date = new Date();
                            var rowCount = $('#tblWh >tbody >tr').length;
                            let day = date.getDate();
                            let month = date.getMonth() + 1;
                            let year = date.getFullYear();
                            let currentDate = `${day}-${month}-${year}`;

                            var doc = new jsPDF();
                            doc.setFont("times");
                            doc.autoTable({html: '#tblWh', startX: 10, startY: 40
                            });
                            doc.addImage(logo, 'PNG', 10, 5);
                            doc.text("2HAT Warehouses", 86, 13);
                            doc.text(`Transactions report (${rowCount} nearest transactions)`, 73, 24);
                            doc.setFont("times");
                            doc.setFontSize(12);
                            doc.text(`Date created: ${currentDate}`, 154, 33);
                            doc.save(`transaction_report_${currentDate}.pdf`);
                        }
                        $(document).ready(function () {
                            $('.nav-trans').addClass('active');
                            $('#tblWh').dataTable();
                        });
            </script>
        </div>
    </div>
</body>
</html>
